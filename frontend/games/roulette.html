<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Casino â€“ Roulette</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #121212;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
    }

    .container {
        max-width: 500px;
        margin: 40px auto;
        padding: 20px;
        background: #1e1e1e;
        border-radius: 12px;
        box-shadow: 0px 0px 15px rgba(0,0,0,0.4);
    }

    h1 {
        color: #e0e0e0;
        margin-bottom: 10px;
    }

    #points {
        font-size: 20px;
        margin-bottom: 25px;
        color: #f1c40f;
    }

    /* Auswahl-Buttons */
    button {
        cursor: pointer;
    }

    .btn {
        padding: 12px 18px;
        margin: 5px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        transition: 0.2s;
    }
    .btn:hover {
        opacity: 0.8;
    }

    .btn-red { background: #e74c3c; }
    .btn-black { background: #000; color: white; border: 1px solid #555; }
    .btn-blue { background: #3498db; }
    .btn-purple { background: #8e44ad; }
    .btn-green { background: #2ecc71; }

    #number-input {
        padding: 10px;
        width: 120px;
        margin-top: 10px;
        border-radius: 6px;
        border: none;
        text-align: center;
    }

    #betAmount {
        padding: 10px;
        width: 150px;
        border-radius: 6px;
        border: none;
        text-align: center;
        margin-top: 10px;
        font-size: 16px;
    }

    /* Roulette Wheel */
    #wheel {
        margin: 30px auto;
        width: 220px;
        height: 220px;
        border-radius: 50%;
        border: 6px solid #444;
        background: url("roulette_wheel.png") center/cover no-repeat;
        animation-duration: 4s;
        animation-timing-function: ease-out;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(1500deg); }
    }

    /* Ergebnis-Box */
    #result-box {
        background: #252525;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        min-height: 70px;
        font-size: 18px;
        color: #ecf0f1;
    }
</style>
</head>
<body>

<div class="container">
    <h1>ðŸŽ° Roulette</h1>

    <div id="points">Punkte werden geladen...</div>

    <h3>Wette auswÃ¤hlen</h3>

    <div>
        <button class="btn btn-red" onclick="setBet('color','red')">ðŸ”´ Rot</button>
        <button class="btn btn-black" onclick="setBet('color','black')">âš« Schwarz</button>
    </div>

    <div>
        <button class="btn btn-blue" onclick="setBet('even_odd','even')">Gerade</button>
        <button class="btn btn-purple" onclick="setBet('even_odd','odd')">Ungerade</button>
    </div>

    <div>
        <input id="number-input" type="number" min="0" max="36" placeholder="Zahl 0â€“36">
        <button class="btn btn-green" onclick="setNumberBet()">Zahl setzen</button>
    </div>

    <h3>Einsatz</h3>
    <input id="betAmount" type="number" value="50" min="1">

    <button class="btn btn-green" style="margin-top: 15px;" onclick="spin()">ðŸŽ² Spielen</button>

    <div id="wheel"></div>

    <div id="result-box"></div>
</div>

<script>

// ðŸ”¹ CSRF aus Cookies holen
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}

const API_BASE = "http://localhost:8000/api/casino";

let betType = null;
let betValue = null;

// ðŸ”¹ Punkte aus backend laden
async function loadPoints() {

    await fetch(`${API_BASE}/session/`, { credentials: "include" });

    const res = await fetch(`${API_BASE}/session/`, { credentials: "include" });
    const data = await res.json();

    if (data.authenticated) {
        document.getElementById("points").innerText = `ðŸ’° Punkte: ${data.user.points}`;
    } else {
        document.getElementById("points").innerText = "Nicht eingeloggt!";
    }
}

function setBet(type, value) {
    betType = type;
    betValue = value;
    document.getElementById("result-box").innerText = `GewÃ¤hlt: ${type} = ${value}`;
}

function setNumberBet() {
    let number = document.getElementById("number-input").value;

    if (number === "" || number < 0 || number > 36) {
        alert("Bitte eine gÃ¼ltige Zahl auswÃ¤hlen (0â€“36)");
        return;
    }

    betType = "number";
    betValue = parseInt(number);
    document.getElementById("result-box").innerText = `GewÃ¤hlt: Zahl ${betValue}`;
}

// ðŸ”¹ Animation starten + Backend anfragen
async function spin() {

    if (!betType || betValue === null) {
        alert("Bitte zuerst eine Wette auswÃ¤hlen!");
        return;
    }

    const stake = parseInt(document.getElementById("betAmount").value);
    const csrfToken = getCookie("csrftoken");

    // Animation starten
    const wheel = document.getElementById("wheel");
    wheel.style.animation = "spin 3.5s ease-out";

    setTimeout(() => {
        wheel.style.animation = "";
    }, 3500);

    // Backend request
    const res = await fetch(`${API_BASE}/play-roulette/`, {
        method: "POST",
        credentials: "include",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": csrfToken
        },
        body: JSON.stringify({
            bet_type: betType,
            number: betValue,
            amount: stake
        })
    });

    const data = await res.json();

    if (data.error) {
        alert(data.error);
        return;
    }

    document.getElementById("result-box").innerHTML = `
        ðŸŽ¯ Ergebnis: ${data.result_number} (${data.result_color})<br>
        ðŸ’µ Gewinn: ${data.win_amount}<br>
        ðŸ’° Neuer Kontostand: ${data.new_points}
    `;

    loadPoints();
}

loadPoints();

</script>

</body>
</html>