<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Gambling Site</title>
  <style>
    @font-face {
      font-family: 'Dalek Pinpoint';
      src: url("fonts/DalekPinpointBold.woff2") format('woff2'),
           url("fonts/DalekPinpointBold.woff") format('woff');
      font-weight: bold;
      font-style: normal;
    }
    body {
      margin: 0;
      padding: 0;
      background-color: #1e1e1e;
      font-family: 'Dalek Pinpoint', sans-serif;
      color: #fff;
      text-align: center;
    }
    header {
      padding: 40px 0;
      position: relative;
    }
    h1 {
      margin: 0;
      font-size: 5rem;
      line-height: 1.2;
    }
    #username-display {
      position: absolute;
      right: 30px;
      top: 25px;
      font-size: 1.5rem;
      color: #1abc9c;
    }

/* üîπ Username klickbar machen */
#username-display {
  cursor: pointer;          /* zeigt Handcursor statt Textcursor */
  user-select: none;        /* verhindert Textmarkierung */
  transition: color 0.2s, transform 0.2s;
}

#username-display:hover {
  color: #16e0b5;           /* etwas helleres Gr√ºn beim Hover */
  transform: scale(1.05);   /* leicht vergr√∂√üern f√ºr Feedback */
}


    #logout-btn {
      position: absolute;
      right: 30px;
      top: 60px;
      font-size: 1rem;
      background: #444;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 8px;
      cursor: pointer;
      display: none;
    }
    #logout-btn:hover {
      background-color: #1abc9c;
    }
    p {
      font-size: 2rem;
      margin-top: 40px;
    }
    .image-container {
      display: flex;
      gap: 100px;
      justify-content: center;
      flex-wrap: wrap;
      padding: 80px 0 40px 0;
    }
    .image-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0.5;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .image-box.enabled {
      opacity: 1;
      pointer-events: all;
    }
    .image-box a img, .image-box img {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgb(28, 87, 3);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .image-box a img:hover {
      transform: scale(1.1);
      cursor: pointer;
      box-shadow: 0 0 20px #1abc9c;
    }
    .image-box span {
      margin-top: 15px;
      color: white;
      font-size: 1.2rem;
    }

    /* Registrierung */
    .register-container {
      margin-top: 60px;
      background-color: #222;
      display: inline-block;
      padding: 20px 40px;
      border-radius: 15px;
      box-shadow: 0 0 10px #1abc9c;
    }
    .register-container input {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
    }
    .register-container button {
      background-color: #1abc9c;
      color: white;
      font-size: 1.2rem;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .register-container button:hover {
      background-color: #159d82;
    }

/* üîπ Popup-Styling */
.popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.popup.hidden {
  display: none;
}

.popup-content {
  background: #222;
  border: 2px solid #1abc9c;
  border-radius: 12px;
  padding: 25px 40px;
  color: #fff;
  box-shadow: 0 0 20px #1abc9c;
  text-align: left;
  min-width: 300px;
}

.popup-content h3 {
  margin-top: 0;
  color: #1abc9c;
}

#close-popup {
  margin-top: 15px;
  background-color: #1abc9c;
  border: none;
  color: #fff;
  border-radius: 8px;
  padding: 8px 16px;
  cursor: pointer;
}

#close-popup:hover {
  background-color: #159d82;
}

#leaderboard-btn {
  position: absolute;
  right: 135px;
  top: 22px;
  font-size: 1.8rem;
  background: none;
  border: none;
  cursor: pointer;
  color: #f0c330;
  transition: transform 0.2s, color 0.2s;
}

#leaderboard-btn:hover {
  transform: scale(1.1);
  color: #ffd700;
}

#leaderboard-popup input {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: none;
  margin-top: 5px;
  margin-bottom: 10px;
  font-size: 1rem;
}


  </style>
</head>
<body>

  <header>
    <h1>Student Gambling Site!</h1>
    <div id="username-display"></div>
    <div id="points-display" style="position:absolute; right:30px; top:90px; font-size:1.2rem; color:#f0c330;"></div> <!-- Punkte-Anzeige -->
    <button id="logout-btn">Logout</button>
    <button id="leaderboard-btn" title="Top Spieler">üèÜ</button>

  </header>

<!-- üîπ Popup-Fenster f√ºr User-Info -->
<div id="user-info-popup" class="popup hidden">
  <div class="popup-content">
    <h3>üë§ Benutzerinfo</h3>
    <p><strong>Username:</strong> <span id="popup-username"></span></p>
    <p><strong>E-Mail:</strong> <span id="popup-email"></span></p>
    <p><strong>ID:</strong> <span id="popup-id"></span></p>
    <button id="close-popup">Schlie√üen</button>
  </div>
</div>

<!-- üîπ Leaderboard-Popup -->
<div id="leaderboard-popup" class="popup hidden">
  <div class="popup-content">
    <h3>üèÜ Top 50 Spieler</h3>
    <input type="text" id="search-player" placeholder="Spieler suchen..." />
    <table id="leaderboard-table" style="width:100%; margin-top:15px; color:white;">
      <thead>
        <tr><th>#</th><th>Username</th><th>Punkte</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="close-leaderboard">Schlie√üen</button>
  </div>
</div>

  <p>Choose a game to play...</p>

  <div class="image-container">
    <div class="image-box">
      <a href="games/roulette.html">
        <img src="images_starting_page/roulette.png" alt="Roulette" />
      </a>
      <span>Roulette</span>
    </div>
    <div class="image-box">
      <a href="games/blackjack.html">
        <img src="images_starting_page/blackjack.png" alt="Blackjack" />
      </a>
      <span>Blackjack</span>
    </div>
    <div class="image-box">
      <img src="images_starting_page/poker.png" alt="Poker" />
      <span>Poker</span>
    </div>
    <div class="image-box">
      <a href="games/baccarat.html">
      <img src="images_starting_page/baccarat.png" alt="Baccara" />
      </a>
      <span>Baccarat</span>
    </div>
  </div>

  <!-- Registrierung -->
  <div id="register-section" class="register-container">
    <h2>Registriere dich, um zu spielen!</h2>
    <form id="registerForm">
      <input type="text" name="username" placeholder="Benutzername" required />
      <input type="email" name="email" placeholder="E-Mail" required />
      <input type="password" name="password" placeholder="Passwort" required />
      <button type="submit">Registrieren</button>
    </form>
  </div>

  <!-- Anmeldung -->
<div id="login-section" class="register-container" style="display:none;">
  <h2>Bereits registriert? Melde dich an!</h2>
  <form id="loginForm">
    <input type="text" name="username" placeholder="Benutzername" required />
    <input type="password" name="password" placeholder="Passwort" required />
    <button type="submit">Login</button>
  </form>
</div>

<script>
  // üîπ CSRF-Cookie vom Server anfordern (beim Start)
fetch("https://michi22.pythonanywhere.com/api/casino/session/", { credentials: "include" });

  // üîπ CSRF-Token aus Cookie holen
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }

  const registerSection = document.getElementById("register-section");
  const loginSection = document.getElementById("login-section");
  const usernameDisplay = document.getElementById("username-display");
  const logoutBtn = document.getElementById("logout-btn");
  const imageBoxes = document.querySelectorAll(".image-box");

  function enableGames() {
    imageBoxes.forEach(box => box.classList.add("enabled"));
  }

  function disableGames() {
    imageBoxes.forEach(box => box.classList.remove("enabled"));
  }

const pointsDisplay = document.getElementById("points-display");

  // üîπ Session pr√ºfen beim Laden
  async function checkSession() {
    try {
      const res = await fetch("https://michi22.pythonanywhere.com/api/casino/session/", {
        credentials: "include"
      });
      const data = await res.json();

      if (data.authenticated) {
        usernameDisplay.textContent = "üë§ " + data.user.username;
        pointsDisplay.textContent = "üí∞ " + data.user.points + " Punkte";
        registerSection.style.display = "none";
        loginSection.style.display = "none";
        logoutBtn.style.display = "inline-block";
        enableGames();
      } else {
        usernameDisplay.textContent = "";
        pointsDisplay.textContent = "";
        registerSection.style.display = "inline-block";
        loginSection.style.display = "inline-block";
        logoutBtn.style.display = "none";
        disableGames();
      }
    } catch (err) {
      console.error("Fehler beim Pr√ºfen der Session:", err);
    }
  }

  checkSession();

  // üîπ Registrierung
  document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(e.target));

    try {
      const response = await fetch("https://michi22.pythonanywhere.com/api/casino/register/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie("csrftoken")
        },
        credentials: "include",
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (response.ok) {
        alert("Willkommen, " + data.user.username + "!");
        checkSession();
      } else {
        alert("Fehler: " + (data.error || "Unbekannter Fehler"));
      }
    } catch (err) {
      alert("Serverfehler: " + err.message);
    }
  });

  // üîπ Login
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(e.target));

    try {
      const response = await fetch("https://michi22.pythonanywhere.com/api/casino/login/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": getCookie("csrftoken")
        },
        credentials: "include",
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (response.ok) {
        alert("Willkommen zur√ºck, " + data.user.username + "!");
        checkSession();
      } else {
        alert("Fehler: " + (data.error || "Ung√ºltige Anmeldedaten"));
      }
    } catch (err) {
      alert("Serverfehler: " + err.message);
    }
  });

  // üîπ Logout (mit CSRF-Token)
  logoutBtn.addEventListener("click", async () => {
    const csrftoken = getCookie('csrftoken');
    try {
      const res = await fetch("https://michi22.pythonanywhere.com/api/casino/logout/", {
        method: "POST",
        credentials: "include",
        headers: {
          "X-CSRFToken": csrftoken
        }
      });
      if (res.ok) {
        alert("Logout erfolgreich.");
        checkSession();
      } else {
        console.error("Logout fehlgeschlagen.", res.status);
      }
    } catch (err) {
      console.error("Fehler beim Logout:", err);
    }
  });

// Punkte-Updates per Polling (alle 3 Sekunden)
function updatePointsPeriodically() {
  setInterval(async () => {
    try {
      const res = await fetch("https://michi22.pythonanywhere.com/api/casino/session/", {
        credentials: "include"
      });
      const data = await res.json();
      if (data.authenticated) {
        const pointsDisplay = document.getElementById("points-display");
        pointsDisplay.textContent = "üí∞ " + data.user.points + " Punkte";
      }
    } catch (err) {
      console.error("Fehler beim Aktualisieren der Punkte:", err);
    }
  }, 3000); // Alle 3 Sekunden
}

// Starte Polling nach erfolgreichem Login
updatePointsPeriodically();

// üîπ User-Info Popup anzeigen beim Klick auf den Username oder Kopf
const userInfoPopup = document.getElementById("user-info-popup");
const popupUsername = document.getElementById("popup-username");
const popupEmail = document.getElementById("popup-email");
const popupId = document.getElementById("popup-id");
const closePopup = document.getElementById("close-popup");

usernameDisplay.addEventListener("click", async () => {
  try {
    const res = await fetch("https://michi22.pythonanywhere.com/api/casino/session/", {
      credentials: "include"
    });
    const data = await res.json();

    if (data.authenticated) {
      popupUsername.textContent = data.user.username;
      popupEmail.textContent = data.user.email;
      popupId.textContent = data.user.id;
      userInfoPopup.classList.remove("hidden");
    } else {
      alert("Du bist nicht eingeloggt!");
    }
  } catch (err) {
    console.error("Fehler beim Laden der Userdaten:", err);
  }
});

closePopup.addEventListener("click", () => {
  userInfoPopup.classList.add("hidden");
});

// Optional: Klick au√üerhalb schlie√üt Popup
userInfoPopup.addEventListener("click", (e) => {
  if (e.target === userInfoPopup) {
    userInfoPopup.classList.add("hidden");
  }
});

// üîπ Leaderboard-Popup-Logik
const leaderboardBtn = document.getElementById("leaderboard-btn");
const leaderboardPopup = document.getElementById("leaderboard-popup");
const closeLeaderboard = document.getElementById("close-leaderboard");
const leaderboardTable = document.querySelector("#leaderboard-table tbody");
const searchPlayerInput = document.getElementById("search-player");

async function loadLeaderboard(query = "") {
  let url = "https://michi22.pythonanywhere.com/api/casino/leaderboard/";
  if (query) {
    url += `?search=${encodeURIComponent(query)}`;
  }
  const res = await fetch(url);
  const data = await res.json();

  leaderboardTable.innerHTML = "";
  data.forEach(player => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${player.rank ? player.rank : "-"}</td>
      <td>${player.username}</td>
      <td>${player.points}</td>
    `;
    leaderboardTable.appendChild(row);
  });
}

leaderboardBtn.addEventListener("click", async () => {
  await loadLeaderboard();
  leaderboardPopup.classList.remove("hidden");
});

closeLeaderboard.addEventListener("click", () => {
  leaderboardPopup.classList.add("hidden");
});

leaderboardPopup.addEventListener("click", (e) => {
  if (e.target === leaderboardPopup) {
    leaderboardPopup.classList.add("hidden");
  }
});

searchPlayerInput.addEventListener("input", async (e) => {
  const query = e.target.value.trim();
  await loadLeaderboard(query);
});


</script>
</body>
</html>















